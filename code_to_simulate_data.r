# pre_link1.csv predicted link function values for cross-validation# sim1_da1.csv  data for cross validation in simulation 1# similar sim1_da2 and sim1_da3# sim1.csv  simulated data, the first simulation# dummy.sim1.csv dummy variables for the first simulated data with all the baseline in#code for simulationsetwd(dirname(file.choose()))library(grplasso)nf<-800timestamp()->t1for (j in 1:20){set.seed(19870+j)x<-c('A','B','C')sim.da1<-NULLfor (i in 1:nf){# sample(x, 120, replace=TRUE)->samsim.da1<-rbind(sim.da1,sample(x, 120, replace=TRUE))}data.frame(sim.da1)->sim.da1#str(sim.da1)paste("Q", 1:120, sep = "")->colpaste("Farm", 1:nf, sep = "")->rowcolnames(sim.da1)<-colrownames(sim.da1)<-row#edit(sim.da1)->sim.da1#get dummy variableslibrary(nnet)dummy.sim1<-NULLfor (k in 1:ncol(sim.da1)) {tmp=class.ind(sim.da1[,k])colnames(tmp)=paste(col[k],colnames(tmp))dummy.sim1=cbind(dummy.sim1,tmp)}#dim(dummy.sim1)#edit(dummy.sim1)->dummy.sim1data.frame(dummy.sim1)->dummy.sim1#get estimated probability#c(rep(c(1/4,0,-1/4),40),rep(c(1/4,0,0),40),rep(c(0,0,0),40))->s1#as.matrix(dummy.sim1)%*%s1-40/3/4->link1#Mar2,2012, use another setting of parameters#c(rep(c(1/2,0,-1/2),40),rep(c(1/2,0,0),40),rep(c(0,0,0),40))->s1#as.matrix(dummy.sim1)%*%s1-40/3/2->link1

#Mar3,2012, use another setting of parameters
c(rep(c(1,0,-1),40),rep(c(1,0,0),40),rep(c(0,0,0),40))->s1
as.matrix(dummy.sim1)%*%s1-40/3->link1exp(link1)/(exp(link1)+1)->hp1res<-rep(9,nf)for (i in 1:nf){sample( c(1,0),1,prob=c(hp1[i],1-hp1[i]))->res[i]}#table(res)#delete baseline variablesbase.idx<-3*c(1:120)dummy1<-dummy.sim1[,-base.idx]#str(dummy1)#da1 is the data set WITH response variables WITHOUT category indicators#da2 is the data set WITHOUT response variable WITH question indicator in the last row#da3 is the data WITHOUT response variable and question indicatordummy1$y<-resda1<-dummy1y<-da1$yind<-NULLfor (i in 1:120){c(ind,rep(i,2))->ind}da2<-rbind(da1[,1:240],ind)da3<-da1[,1:240]#write.csv(pre,paste('pre_link',j,',csv',sep=''),row.names=F)write.csv(da1,paste('sim',j,'_da',1,'.csv',sep=''),row.names=F)write.csv(da2,paste('sim',j,'_da',2,'.csv',sep=''),row.names=F)write.csv(da3,paste('sim',j,'_da',3,'.csv',sep=''),row.names=F)write.csv(sim.da1,paste('sim',j,'.csv',sep=''),row.names=F)write.csv(dummy.sim1,paste('dummy.sim',j,'.csv',sep=''),row.names=F)}timestamp()->t2